"use strict";const loadingEl=document.querySelector(".loading"),loadingAnimationEl=loadingEl.querySelector(".loading-animation"),viewportEl=document.querySelector(".viewport"),containerEl=viewportEl.querySelector(".container"),dateEl=containerEl.querySelector(".date"),contactButton=containerEl.querySelector(".contact"),worksEl=containerEl.querySelector(".works"),contactEl=document.querySelector("#contact"),sayHelloEl=contactEl.querySelector(".say-hello"),formEl=sayHelloEl.querySelector("form"),inputEls=formEl.querySelectorAll("input"),textareaEls=formEl.querySelectorAll("textarea"),inputNameEl=formEl.querySelector(".input-name"),inputCompanyEl=formEl.querySelector(".input-company"),inputEmailEl=formEl.querySelector(".input-email"),inputSubjectEl=formEl.querySelector(".input-subject"),titleMessageEl=formEl.querySelector(".title-message"),textareaMessageEl=formEl.querySelector(".textarea-message"),sendButton=formEl.querySelector(".send"),appreciationEl=contactEl.querySelector(".appreciation"),footerEl=containerEl.querySelector("footer"),toTopButton=footerEl.querySelector(".to-top"),isTouchDevice="ontouchstart"in document.documentElement,isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isSafari=navigator.userAgent.toLowerCase().indexOf("safari")>-1;let bodyWidth=0,screenScale=0,time=new Date,isValidated=!1;const pagingSound=new Audio("/public/assets/audio/page.mp3"),typingSound=new Audio("/public/assets/audio/type.mp3");function disableScroll(){document.body.style.overflow="hidden"}function enableScroll(){document.body.style.overflow=""}async function endLoading(delay=0){await new Promise(resolve=>{setTimeout(()=>{loadingEl.classList.add("animated"),resolve()},1e3*delay)}),await new Promise(resolve=>{setTimeout(()=>{removeElement(loadingEl),resolve()},1e3*delay+1500)})}function updateDate(){dateEl.textContent=getFormatDate(time)}function getFormatDate(time){return`${convertToMonth(time.getMonth()+1)} ${time.getDate()}, ${time.getFullYear()}`}function convertToMonth(num){return["January","February","March","April","May","June","July","August","September","October","November","December"][num-1]}function setTimeoutToCheckDateEveryMinute(){setTimeout(checkDateEveryMinute,1e3*(60-time.getSeconds()))}function checkDateEveryMinute(){const newTime=new Date;time.getDate()!==newTime.getDate()&&(time=newTime,updateDate()),setTimeout(checkDateEveryMinute,1e3*(60-newTime.getSeconds()))}async function updateWorks(){const works=await loadData("/public/data/works.json");let worksHTML="";works.forEach((work,idx)=>{worksHTML+=`\n      <li class="work">\n        <a href="${work.link}" target="_blank" rel="noreferrer noopener">\n          <picture>\n            <source srcset="${`/public/assets/img/webp/${work.title.replaceAll(" ","_")}.webp`}" type="image/webp">\n            <source srcset="${`/public/assets/img/original/${work.title.replaceAll(" ","_")}.png`}" type="image/png"> \n            <img src="${`/public/assets/img/original/${work.title.replaceAll(" ","_")}.png`}" alt="${work.title}" loading="lazy">\n          </picture>\n        </a>\n        <section>\n          <div class="number">${formatNumber(works.length-idx)}</div>\n          <div class="title">${work.title}</div>\n          <div class="subtitle">${work.subtitle}${work.repo?` (<a class="info" href="${`/projects/?repo=${work.repo}${"justify"!==work.align?`&align=${work.align}`:""}`}">info</a>)`:""}\n          </div>\n        </section>\n      </li>\n    `}),worksEl.innerHTML=worksHTML}async function loadData(api){const res=await fetch(api);return await res.json()}function formatNumber(num){return num<10?"0"+num:""+num}function scrollToggleClass(els,className){els.forEach((el,idx)=>{ScrollTrigger.create({trigger:el,id:idx+1,start:"top center",end:()=>`+=${el.clientHeight}`,toggleAction:"play reverse none reverse",toggleClass:{targets:el,className:className}})})}function toggleGrayscale(el){if(el.classList.contains("color"))return el.classList.add("grayscale");el.classList.remove("grayscale")}function activateHoverInteraction(els){els.forEach(el=>el.classList.add("hover-interaction"))}function parallax(){gsapWithScrollTrigger(".circle-yellow",{y:1200*screenScale}),gsapWithScrollTrigger(".circle-red",{y:2400*screenScale}),gsapWithScrollTrigger(".article-left",{y:200*screenScale}),gsapWithScrollTrigger(".article-right",{y:200*screenScale}),gsapWithScrollTrigger(".name",{y:-500*screenScale})}function killScrollTriggers(){ScrollTrigger.getAll().forEach(el=>el.kill())}function gsapWithScrollTrigger(className,animation,scrub=1){ScrollTrigger.create({animation:gsap.to(className,animation),scrub:scrub})}function appendCircle(e,el,duration=1.5){const circle=document.createElement("div");circle.classList.add("circle");const circleOffset=.25*document.body.getBoundingClientRect().width;let customCursorOffset=-.004*document.body.getBoundingClientRect().width;isTouchDevice&&(customCursorOffset=0),circle.style.left=`${e.pageX-circleOffset-customCursorOffset}px`,circle.style.top=`${e.pageY-circleOffset-customCursorOffset}px`,circle.style.animationDuration=`${duration}s`,el.appendChild(circle),setTimeout(()=>removeElement(circle),1e3*duration)}function getCleanText(text){return 1===text.length?text.toString().replace(" ",""):text.toString().replace(/  /g," ").replace(/%3C/gi,"").replace(/(<([^>]+)>)/gi,"")}function getTextWithoutWhiteSpace(text){return text.toString().replace(/ /g,"")}function autoExpand(el){const offset=el.offsetHeight-el.clientHeight;el.style.height="auto",el.style.height=el.scrollHeight+offset+"px"}function submitForm(e){if(e.preventDefault(),isValidated=!0,checkForm(),!isValidated)return!1;emptyForm(),hideForm(),setTimeout(()=>{const receiver="rayc2045@gmail.com";window.open(`mailto:${receiver}?subject=${inputSubjectEl.value}&body=${textareaMessageEl.value}`,"_top")},800)}function checkForm(){inputEmailEl.value=inputEmailEl.value.replace(/ /g,""),[inputNameEl,inputCompanyEl,inputEmailEl,inputSubjectEl,textareaMessageEl].map(el=>el.value=el.value.trim());const emailFormat=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;inputNameEl.value||(isValidated=!1,alertAnimate(inputNameEl.parentNode)),inputEmailEl.value.match(emailFormat)||(isValidated=!1,alertAnimate(inputEmailEl.parentNode)),inputSubjectEl.value||(isValidated=!1,alertAnimate(inputSubjectEl.parentNode)),textareaMessageEl.value||(isValidated=!1,alertAnimate(titleMessageEl),alertAnimate(textareaMessageEl.parentNode))}function alertAnimate(el){el.classList.contains("alert")||(el.classList.add("alert"),setTimeout(()=>el.classList.remove("alert"),1e3))}function emptyForm(){inputEls.forEach(el=>el.value=""),textareaEls.forEach(el=>{el.value="",el.style.height="auto"})}function hideForm(){sayHelloEl.classList.add("hide"),appreciationEl.classList.remove("hide")}function putPackForm(){sayHelloEl.classList.remove("hide"),appreciationEl.classList.add("hide")}function isVisible(el){const elTop=~-el.getBoundingClientRect().top,elBottom=~-el.getBoundingClientRect().bottom;return elTop<window.innerHeight&&elBottom>=0}function removeElement(el){el.parentNode.removeChild(el)}function playAudio(audio,volume=1){audio.currentTime=0,audio.volume=volume,audio.play()}function initBodyParams(){document.body.style.height=viewportEl.scrollHeight+"px",bodyWidth=document.body.getBoundingClientRect().width,screenScale=bodyWidth/1280}function resizeBodyHeight(){document.body.style.height=viewportEl.scrollHeight+"px"}document.onselectstart=()=>!1,document.ondragstart=()=>!1,document.oncontextmenu=()=>!1,disableScroll(),updateDate(),setTimeoutToCheckDateEveryMinute(),window.onload=async()=>{initBodyParams(),await updateWorks();const coverEls=worksEl.querySelectorAll(".work > a");scrollToggleClass(coverEls,"color"),isTouchDevice?await endLoading():(activateHoverInteraction([worksEl,footerEl]),coverEls.forEach(cover=>{cover.onmouseenter=()=>coverEls.forEach(cover=>toggleGrayscale(cover)),cover.onmouseout=()=>coverEls.forEach(cover=>cover.classList.remove("grayscale"))}),parallax(),await endLoading(.25)),enableScroll(),resizeBodyHeight()},window.onscroll=()=>{sayHelloEl.classList.contains("hide")&&(isVisible(appreciationEl)||putPackForm())},window.onresize=()=>{initBodyParams(),killScrollTriggers(),isTouchDevice||parallax();const coverEls=worksEl.querySelectorAll(".work > a");scrollToggleClass(coverEls,"color")},document.onfullscreenchange=()=>initBodyParams(),document.onmouseup=e=>{e.target.hasAttribute("href")&&(playAudio(pagingSound),3===e.which&&window.open(e.target.href,"_blank"))},containerEl.onmousedown=e=>{appendCircle(e,containerEl)},contactButton.onmouseup=()=>{playAudio(pagingSound),window.scrollTo(0,contactEl.getBoundingClientRect().top)},toTopButton.onmouseup=()=>{playAudio(pagingSound),window.scrollTo(0,0)},formEl.onkeydown=e=>{setTimeout(()=>e.target.value=getCleanText(e.target.value)),e.target.classList.contains("input-email")&&setTimeout(()=>e.target.value=getTextWithoutWhiteSpace(e.target.value)),playAudio(typingSound,.65)},textareaEls.forEach(el=>{el.oninput=e=>{autoExpand(e.target),resizeBodyHeight()},el.onkeyup=e=>{autoExpand(e.target),resizeBodyHeight()},el.oncut=e=>{autoExpand(e.target),resizeBodyHeight()},el.onpaste=e=>{autoExpand(e.target),resizeBodyHeight()},el.onchange=e=>{autoExpand(e.target),resizeBodyHeight()}}),sendButton.onclick=e=>{submitForm(e),resizeBodyHeight()};